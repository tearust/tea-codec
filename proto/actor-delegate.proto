syntax = "proto2";

package actor_delegate;

message CidHash{
  required string cid = 1;
  required bytes hash = 2;
}
 
message TaskRegisterRequest{
  repeated CidHash cidHash = 1;
  //required bytes ekey1 = 2;
  required bytes blockChainAccount = 3;
  required CidHash wasm = 4;   // wasm 
  required CidHash wasmManifest = 5;  // wasm manifest
  required CidHash wasmChecker = 6;  // wasm checker
  required uint32 payment = 7;  // gas
}

message TaskRegisterResponse{
  optional string RefNum = 1;
  optional string RsaPubKey = 3;
  optional string Error = 2;
}

message AddNewTask{
  required bytes teaId = 1;
  required bytes refNum = 2;
  required bytes rsaPub = 3;
  required string capCid = 4;
  required string modelCid = 5;
  required string dataCid = 6;
  required uint32 payment = 7;
}



message GeneralTaskMessage{
  enum MessageType{
    ApplyToExecuteTaskRequest = 0;
    ApplyToExecuteTaskResponse = 1;
  };
  required MessageType messageType = 1;
  required bytes payload = 2;
  optional bytes TeaId = 3;
  optional bytes Signature = 4;//Sign sha256(payload) by TeaId
}

message ApplyToExecuteTaskRequest{
  required string refNum = 1;

  required bytes RsaPubKey = 3;//Delegate will use this RSA Pub Key to encrypt the key1 when sending to Executor
  //required bytes HashDownloadFile = 4;//this is used to verify if the executor actually downloaded the file from IPFS
  repeated bytes CapCheckers= 5;
}

message TaskBody {
  required bytes refNum = 1;
  required bytes rsaPub = 2;
  required string capCid = 3;
  required string manifestCid = 4;
  required string wasmCid = 5;
  required string dataCid =6;
  required bytes ekey1 = 7;
}

// The following message is used between delegate and facade.
message Task {
  required bytes delegateId = 1;
  required string modelCid = 2;
  required uint32 payment = 3;
  required string bodyCid = 4;
}

message Node {
  required bytes teaId = 1;
  repeated bytes peers = 2;
}

message AddNewTaskRequest {
  required Task task = 1;
}

message AddNewTaskResponse {
  required bytes accountId = 1;
  required Node delegateNode = 2;
  required Task task = 3;
}